# TIGER (Transformer Index for Generative Recommenders) Deep Dive

TIGERは、推薦システムにおける「検索（Retrieval）」を「生成（Generation）」として再定義する画期的なフレームワークです。
その核となるのが、アイテムを意味のあるコード列に変換する **Semantic ID** と、それを生成する **RQ-VAE** です。

## 1. 核心的なアイデア：Semantic ID

従来の推薦システムでは、アイテムIDは単なる連番（1, 2, 3...）であり、ID自体に意味はありませんでした。
TIGERでは、アイテムの内容（タイトル、説明文など）に基づいて、**「意味的に似ているアイテムは、似たIDを持つ」**ようにIDを設計します。

例：
*   アイテムA（アクション映画）: ID `(5, 12, 8)`
*   アイテムB（別のアクション映画）: ID `(5, 12, 20)`
*   アイテムC（恋愛映画）: ID `(9, 3, 15)`

このようにIDが階層構造を持つことで、LLMは「IDを生成すること」＝「アイテムの特徴を特定すること」として学習できます。

## 2. Semantic IDの作り方：RQ-VAE (Residual Quantized VAE)

Semantic IDを自動生成するために使われるのが **RQ-VAE** です。

### 手順
1.  **Embedding化:** アイテムのテキスト情報（タイトル等）をBERTなどで密ベクトル（Embedding）に変換します。
2.  **階層的量子化 (Hierarchical Quantization):**
    *   **Level 1:** Embeddingを最も近い「代表点（コードブック）」に割り当てます。→ 最初のIDトークン `c1` が決定。
    *   **Residual (残差):** 元のEmbeddingと `c1` の差分（ズレ）を計算します。
    *   **Level 2:** その残差を、次のレベルのコードブックで近似します。→ 2番目のIDトークン `c2` が決定。
    *   **Level 3:** さらにその残差を...（以下繰り返し）

このプロセスにより、アイテムは `(c1, c2, c3)` というタプル（Semantic ID）に変換されます。
*   `c1`: 大まかなカテゴリ（例：映画ジャンル）
*   `c2`: サブカテゴリ（例：年代や監督）
*   `c3`: 個別の詳細（例：具体的な作品）

## 3. 推薦の仕組み：Retrieval as Generation

TIGERの推薦プロセスは以下のようになります。

1.  **入力:** ユーザーの視聴履歴（Semantic IDの列）。
    `User History: (5,12,8), (9,3,15), ...`
2.  **生成:** LLM（Transformer）が、次に続くSemantic IDをトークンごとに予測します。
    *   まず `c1` を予測（ジャンルを絞り込む）
    *   次に `c1` を条件として `c2` を予測（さらに絞り込む）
    *   最後に `c3` を予測（アイテムを特定）
3.  **検索:** 生成されたID `(c1, c2, c3)` に対応するアイテムを提示します。

## 4. なぜこれが優れているのか？

*   **近傍探索が不要:** IDを生成した時点でアイテムが特定されるため、巨大なインデックスに対する近傍探索（MIPS）が不要になります。
*   **Cold-Startに強い:** 新しいアイテムでも、その内容からSemantic IDを作れば、即座に推薦候補になります（似たIDのアイテムと同様に扱われるため）。
*   **軽量:** 巨大なEmbeddingテーブルを持つ必要がなく、コードブック（非常に小さい）を持つだけで済みます。

## 5. 実装の難易度

非常に魅力的ですが、実装には以下のハードルがあります。
*   **RQ-VAEの学習:** アイテム空間を適切に分割できるコードブックを学習させる必要があります。
*   **独自のトークナイザ:** LLMの語彙に、Semantic ID用のトークンを追加し、学習させる必要があります。
*   **Collision対策:** 異なるアイテムが同じSemantic IDになってしまう（衝突）場合の処理が必要です。

## 結論
TIGERは「生成アプローチを近傍探索に落とし込む」というよりは、**「近傍探索というプロセス自体を、階層的な生成プロセスに置き換える」**というパラダイムシフトです。
`anyo` のようなDense Retrievalとは対照的ですが、将来的には非常に有望な方向性です。
